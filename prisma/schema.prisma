generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ResFaseI {
  C
  I
  NA
}

enum ResFaseII {
  S
  NS
}

enum ResFaseIII {
  C
  I
  NA
  P
}

enum Calificativo {
  CORRECTO
  ACEPTABLE
  DEFICIENTE
  PENDIENTE
}

enum Resolucion {
  DEVUELTA
  PASA_COMITE
}

model R01Prestamo {
  R01NUM     String   @id @db.Char(8)
  R01Suc_id  String   @db.Uuid
  R01Nso     String   @db.Char(6)
  R01Nom     String
  R01Cat_id  String   @db.Uuid
  R01Pro_id  String   @db.Uuid
  R01Imp     Decimal  @db.Decimal
  R01Dir     String   @db.Char(2)
  R01SP_id   String   @db.Uuid
  R01Ejvo_id String   @db.Uuid
  R01Fsol    DateTime
  R01FRec    DateTime
  R01FRev    DateTime
  R01FMov    DateTime
  R01ObsA    String?
  R01ObsM    String?
  R01ObsB    String?
  R01ObsT    String?
  R01Est     String
  R01Activ   Boolean

  sucursal   R11Sucursal  @relation(fields: [R01Suc_id], references: [R11Id])
  supervisor R12Usuario   @relation("Supervisor", fields: [R01SP_id], references: [R12Id])
  ejecutivo  R12Usuario   @relation("Ejecutivo", fields: [R01Ejvo_id], references: [R12Id])
  producto   R13Producto  @relation(fields: [R01Pro_id], references: [R13Id])
  categoria  R14Categoria @relation(fields: [R01Cat_id], references: [R14Id])

  evaluacionesF1 R05EvaluacionFase1[]
  evaluacionesF2 R07EvaluacionFase2[]
  evaluacionesF3 R09EvaluacionFase3[]
  evaluacionesF4 R15EvaluacionFase4[]

  resumenF1 R06EvaluacionResumenFase1?
  resumenF2 R08EvaluacionResumenFase2?
  resumenF3 R10EvaluacionResumenFase3?
  resumenF4 R16EvaluacionResumenFase4?
}

model R02Grupo {
  R02Id  String     @id @default(uuid()) @db.Uuid
  R02Nom String
  rubros R03Rubro[]
}

model R03Rubro {
  R03Id   String @id @default(uuid()) @db.Uuid
  R03G_id String @db.Uuid
  R03Nom  String

  grupo     R02Grupo      @relation(fields: [R03G_id], references: [R02Id])
  elementos R04Elemento[]
}

model R04Elemento {
  R04Id   String @id @default(uuid()) @db.Uuid
  R04R_id String @db.Uuid
  R04Nom  String
  R04Imp  String

  rubro          R03Rubro             @relation(fields: [R04R_id], references: [R03Id])
  evaluacionesF1 R05EvaluacionFase1[]
  evaluacionesF2 R07EvaluacionFase2[]
  evaluacionesF3 R09EvaluacionFase3[]
  evaluacionesF4 R15EvaluacionFase4[]
}

model R05EvaluacionFase1 {
  R05Id     String   @id @default(uuid()) @db.Uuid
  R05P_num  String   @db.Char(8)
  R05E_id   String   @db.Uuid
  R05Res    ResFaseI @default(NA)
  R05Ev_por String   @db.Uuid
  R05Ev_en  DateTime @default(now())

  prestamo  R01Prestamo @relation(fields: [R05P_num], references: [R01NUM])
  elemento  R04Elemento @relation(fields: [R05E_id], references: [R04Id])
  evaluador R12Usuario  @relation(fields: [R05Ev_por], references: [R12Id])
}

model R06EvaluacionResumenFase1 {
  R06P_num String       @id @db.Char(8)
  R06Ha    Int
  R06Hm    Int
  R06Hb    Int
  R06Rc    Int
  R06Cal   Calificativo
  R06Res   Resolucion

  prestamo R01Prestamo @relation(fields: [R06P_num], references: [R01NUM])
}

model R07EvaluacionFase2 {
  R07Id     String    @id @default(uuid()) @db.Uuid
  R07P_num  String    @db.Char(8)
  R07E_id   String    @db.Uuid
  R07Res    ResFaseII
  R07Obs    String?
  R07Ev_por String    @db.Uuid
  R07Ev_en  DateTime  @default(now())

  prestamo  R01Prestamo @relation(fields: [R07P_num], references: [R01NUM])
  elemento  R04Elemento @relation(fields: [R07E_id], references: [R04Id])
  evaluador R12Usuario  @relation(fields: [R07Ev_por], references: [R12Id])
}

model R08EvaluacionResumenFase2 {
  R08P_num String       @id @db.Char(8)
  R08SolvT Int
  R08SolvA Int
  R08SolvM Int
  R08SolvB Int
  R08Rc    Int
  R08Cal   Calificativo
  R08Res   Resolucion

  prestamo R01Prestamo @relation(fields: [R08P_num], references: [R01NUM])
}

model R09EvaluacionFase3 {
  R09Id     String     @id @default(uuid()) @db.Uuid
  R09P_num  String     @db.Char(8)
  R09E_id   String     @db.Uuid
  R09Res    ResFaseIII
  R09Obs    String?
  R09Ev_por String     @db.Uuid
  R09Ev_en  DateTime   @default(now())

  prestamo  R01Prestamo @relation(fields: [R09P_num], references: [R01NUM])
  elemento  R04Elemento @relation(fields: [R09E_id], references: [R04Id])
  evaluador R12Usuario  @relation(fields: [R09Ev_por], references: [R12Id])
}

model R10EvaluacionResumenFase3 {
  R10P_num      String       @id @db.Char(8)
  R10Ha         Int
  R10Pendientes Int
  R10Rc         Int
  R10Cal        Calificativo

  prestamo R01Prestamo @relation(fields: [R10P_num], references: [R01NUM])
}

model R11Sucursal {
  R11Id     String        @id @default(uuid()) @db.Uuid
  R11NumSuc String
  R11Nom    String
  prestamos R01Prestamo[]
  usuarios  R12Usuario[]
}

model R12Usuario {
  R12Id        String   @id @default(uuid()) @db.Uuid
  R12Ni        String   @unique
  R12Nom       String
  R12Suc_id    String   @db.Uuid
  R12Rol       String
  R12Activ     Boolean
  R12Creado_en DateTime @default(now())

  sucursal R11Sucursal @relation(fields: [R12Suc_id], references: [R11Id])

  Prestamo_Super R01Prestamo[] @relation("Supervisor")

  Prestamo_Ejvo R01Prestamo[] @relation("Ejecutivo")

  EvaluacionFase1 R05EvaluacionFase1[]

  EvaluacionFase2 R07EvaluacionFase2[]

  EvaluacionFase3 R09EvaluacionFase3[]

  EvaluacionFase4 R15EvaluacionFase4[]
}

model R13Producto {
  R13Id     String  @id @default(uuid()) @db.Uuid
  R13Nom    String
  R13Cat_id String  @db.Uuid
  R13Activ  Boolean

  categoria R14Categoria  @relation(fields: [R13Cat_id], references: [R14Id])
  prestamos R01Prestamo[]
}

model R14Categoria {
  R14Id    String  @id @default(uuid()) @db.Uuid
  R14Nom   String
  R14Activ Boolean

  productos R13Producto[]
  prestamos R01Prestamo[]
}

model R15EvaluacionFase4 {
  R15Id     String    @id @default(uuid()) @db.Uuid
  R15P_num  String    @db.Char(8)
  R15E_id   String    @db.Uuid
  R15Res    ResFaseII
  R15Obs    String?
  R15Ev_por String    @db.Uuid
  R15Ev_en  DateTime  @default(now())

  prestamo  R01Prestamo @relation(fields: [R15P_num], references: [R01NUM])
  elemento  R04Elemento @relation(fields: [R15E_id], references: [R04Id])
  evaluador R12Usuario  @relation(fields: [R15Ev_por], references: [R12Id])
}

model R16EvaluacionResumenFase4 {
  R16P_num  String       @id @db.Char(8)
  R16SolvT  Int
  R16SolvA  Int
  R16SolvM  Int
  R16SolvB  Int
  R16SegCal Calificativo
  R16HaSolv Int
  R16PenCu  Int
  R16RcF    Int
  R16DesCal Calificativo
  R16CalF   Calificativo

  prestamo R01Prestamo @relation(fields: [R16P_num], references: [R01NUM])
}
